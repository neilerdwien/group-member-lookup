!function(){function e(){return n("get-environment")}function t(){var e={},t=location.href.split(/[\?&]/),n=t.splice(1);e.url=t[0];for(var a,i,o,s=0;s<n.length;s++)a=n[s].split("="),i=a[0],o=a[1],e[i]=o;r.set(e)}function n(e,t){var n=r,a=null,i=Math.random().toString().slice(2),o={name:e,gid:n.gid,origin:n.url,token:n.token,place:n.place,payload:t,callback:i};a=new $.Deferred;var s=function(e){if(e.origin==n.msghost){var t=e.data;if("string"==typeof t)try{t=JSON.parse(t)}catch(r){return void console.log("Cannot parse message from OU Campus app:",t)}console.log("Response from OU Campus:",t),t.callback==i&&(window.removeEventListener("message",s,!1),a.resolve(t.payload))}};return window.addEventListener("message",s,!1),window.top.postMessage(JSON.stringify(o),n.msghost),a}function a(e){var t=r;if(e.origin==t.msghost){var n=e.data;if("string"==typeof n)try{n=JSON.parse(n)}catch(a){return void console.log("Cannot parse message from OU Campus app:",n)}n.callback||(console.log("Message from OU Campus:",n),"configuration"==n.name&&t.setConfig(n.payload),$(t).trigger(n.name,n.payload))}}var r={ready:function(e){var t=new $.Deferred;return this.isReady?(e&&e(),t.resolve()):$(this).one("ready",function(){e&&e(),t.resolve()}),t},get:function(e){return"object"==typeof this[e]?JSON.parse(JSON.stringify(this[e])):this[e]},set:function(e,t){if("string"==typeof e)this[e]=t;else for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n])},getConfig:function(e){return"object"==typeof this.config[e]?JSON.parse(JSON.stringify(this.config[e])):this.config[e]},setConfig:function(e,t){if("string"==typeof e)this.config[e]=t;else for(var n in e)e.hasOwnProperty(n)&&(this.config[n]=e[n])},fetch:function(){var e=this,t=e.apihost+"/gadgets/view",n={authorization_token:e.token,account:e.account,gadget:e.gid};return $.ajax({type:"GET",url:t,data:n,success:function(t){e.config={};for(var n in t.config)t.config.hasOwnProperty(n)&&(e.config[n]=t.config[n].value)},error:function(e,t,n){console.log("Fetch error:",t,n)}})},save:function(e,t){e&&this.setConfig(e,t);var n=this,a=n.apihost+"/gadgets/configure",r=n.config;return r.authorization_token=n.token,r.account=n.account,r.gadget=n.gid,$.ajax({type:"POST",url:a,data:r,success:function(e){},error:function(e,t,n){console.log("Save error:",t,n)}})},_sendMessageToTop:n,oucGetCurrentFileInfo:function(){return n("get-current-file-info")},oucInsertAtCursor:function(e){return n("insert-at-cursor",e)},oucGetCurrentLocation:function(){return n("get-location")},oucSetCurrentLocation:function(e){return n("set-location",e)},oucRefreshLocation:function(){return n("refresh-location")},oucGetWYSIWYGSelection:function(){return n("get-wysiwyg-selection")},oucGetWYSIWYGContent:function(){return n("get-wysiwyg-content")},oucGetSourceContent:function(){return n("get-source-content")}};for(var i in r)r[i]=r[i].bind(r);var o={_request:function(e,t,n,a,i){a||(a={}),i||(i={}),a.action=n,this._paramValidation(a);var o={type:e,dataType:"json",url:r.apihost+t,data:{site:a.ou_site||r.site,authorization_token:r.token}};return o=this._cleanProps(a,o),$.ajax($.extend(o,i))},_paramValidation:function(e){if(!e)throw"Missing parameters for Metadata API request.";if(!e.action)throw"Missing 'action' property in options object";switch(e.action){case"create":if(!e.mime_type||!e.metadata)throw"Missing required parameter '"+(e.mime_type?"metadata":"mime_type")+"' for '"+e.action+"' Metadata API request";break;case"list":if(!e.mime_type)throw"Missing required parameter 'mime_type' for '"+e.action+"' Metadata API request";break;case"link":case"unlink":if(!e.item)throw"Missing required parameter 'item' for '"+e.action+"' Metadata API request";if(!e.id)throw"Missing required parameter 'id' for '"+e.action+"' Metadata API request";break;case"grouplink":case"groupunlink":if(!e.groups)throw"Missing required parameter 'groups' for '"+e.action+"' Metadata API request";if(!e.id)throw"Missing required parameter 'id' for '"+e.action+"' Metadata API request";break;case"update":case"delete":case"view":if(!e.id)throw"Missing required parameter 'id' for '"+e.action+"' Metadata API request";break;default:return}},_cleanProps:function(e,t){for(var n in e){var a;switch(n){case"mime_type":case"metadata":case"metadatas":case"scope":case"groups":case"item":case"item_type":case"id":case"ids":case"asset":case"page":case"directory":case"site":case"ou_site":a=!0;break;default:a=!1}a&&(t.data[n]=e[n],delete e[n])}return t},create:function(e,t){return this._request("POST","/metadata/new","create",e,t)},update:function(e,t){return this._request("POST","/metadata/save","save",e,t)},"delete":function(e,t){return this._request("POST","/metadata/delete","delete",e,t)},list:function(e,t){return this._request("GET","/metadata/list","list",e,t)},view:function(e,t){return this._request("GET","/metadata/view","view",e,t)},link:function(e,t){return this._request("POST","/metadata/"+e.link_type+"link","link",e,t)},unlink:function(e,t){return this._request("POST","/metadata/"+e.link_type+"unlink","unlink",e,t)},groupLink:function(e,t){return this._request("POST","/metadata/grouplink","grouplink",e,t)},groupUnlink:function(e,t){return this._request("POST","/metadata/groupunlink","groupunlink",e,t)}};r.Metadata=o,r.set(t()),e().then(function(e){"Unrecognized message."!=e&&r.set(e),r.isReady=!0,$(r).trigger("ready")}),window.addEventListener("message",a,!1),window.gadget=r,window.Gadget=function(){},window.Gadget.prototype=r}();